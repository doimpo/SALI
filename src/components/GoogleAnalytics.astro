---
// Google Analytics component - Optimized for performance
// Set your Google Analytics 4 tracking ID in environment variable or here
const trackingId = import.meta.env.PUBLIC_GA_TRACKING_ID || ''; // Set in .env as PUBLIC_GA_TRACKING_ID=G-XXXXXXXXXX
const isProduction = import.meta.env.PROD;
const shouldLoadGA = trackingId && isProduction;
---

{shouldLoadGA && (
  <>
    <!-- Google tag (gtag.js) - Optimized with defer -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    
    <script type="text/partytown" src={`https://www.googletagmanager.com/gtag/js?id=${trackingId}`}></script>
    <script type="text/partytown" define:vars={{ trackingId }}>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', trackingId, {
        page_title: document.title,
        page_location: window.location.href,
        send_page_view: true,
        anonymize_ip: true
      });

      // Track medical service interest (can be called from buttons/forms)
      window.trackServiceInterest = function(serviceName) {
        if (typeof gtag !== 'undefined') {
          gtag('event', 'select_content', {
            content_type: 'medical_service',
            item_id: serviceName,
            item_name: serviceName
          });
        }
      };

      // Track appointment interest
      window.trackAppointmentInterest = function() {
        if (typeof gtag !== 'undefined') {
          gtag('event', 'generate_lead', {
            currency: 'INR',
            value: 0,
            event_category: 'engagement',
            event_label: 'appointment_interest'
          });
        }
      };

      // Track emergency contact
      window.trackEmergencyContact = function() {
        if (typeof gtag !== 'undefined') {
          gtag('event', 'contact', {
            event_category: 'engagement',
            event_label: 'emergency_contact'
          });
        }
      };
    </script>
  </>
)}

<!-- Development mode indicator -->
{!isProduction && (
  <script is:inline>
    console.log('ðŸ“Š Google Analytics is disabled in development mode');
  </script>
)}
